;---------------------------------------PRWOW   ;i:IX - Structure Of Window        LD A,(IX)        OR A:JP Z,WOW        CP 1:JR Z,WOW1        CP 2:RET NZ        CALL WOW        LD A,(IX+17):OR A:JR Z,Hk1        LD L,(IX+16)        LD H,A        LD DE,0:CALL TXTPRHk1     LD A,(IX+19):OR A:JR Z,Hk2        LD L,(IX+18)        LD H,A        LD D,(IX+5):DEC D        LD E,0:CALL TXTPRHk2     LD A,(IX+21):OR A:RET Z        LD L,(IX+20),H,A        LD DE,#0101:JP TXTPR;-------WOW1    CALL WOW        LD A,(IX+13):OR A:JR Z,HK1        LD L,(IX+12),H,A        LD DE,0:CALL TXTPRHK1     LD A,(IX+15):OR A:JR Z,HK2        LD L,(IX+14),H,A        LD D,(IX+5):DEC D        LD E,0:CALL TXTPRHK2     LD A,(IX+17):OR A:RET Z        LD L,(IX+16),H,A        LD DE,#0101:JP TXTPR;-------WOW     CALL GPOZA        PUSH HL:CALL GRESB:POP HL        EI:HALT        LD A,(IX+4):DEC A:LD (FLL+1),A        LD A,(IX+6),(AA0+1),A,(AA1+1),A        LD DE,#C9BB,C,#CD:CALL FLL        LD A,(IX+5)        SUB 2:JR Z,OMS        LD DE,#BABA,C,#20HE1     CP (IX+10):JR Z,HET        CP (IX+11):JR Z,HET        CALL FLLLET     DEC A:JR NZ,HE1OMS     LD DE,#C8BC,C,#CD:CALL FLL        RET;-------HET     PUSH DE,BC        LD DE,#C7B6,C,#C4        CALL FLL        POP BC,DE        JR LET;---------------------------------------FLL     LD B,0        PUSH HL        LD (HL),D        SET 7,LAA0     LD (HL),0        RES 7,LWE      INC HL:LD (HL),C        SET 7,LAA1     LD (HL),0        RES 7,L        DJNZ WE        LD (HL),E        POP HL        INC H        RET;-------GRESB   LD A,(IX+4):OR A:JR NZ,GRB_        LD (IX+4),WIDGRB_    LD A,(IX+5):OR A:JR NZ,GRB        LD A,(HEI),(IX+5),AGRB     LD A,(IX+8):OR (IX+9):RET NZ        LD DE,(RSQBC)        LD (IX+8),E        LD (IX+9),D        LD A,(IX+4),(He2a),A,(He2b),A        LD A,(IX+5)        EXA        LD A,RESB:CALL MNg8        LD A,L        EXA        LD B,0HE2     EXAHe2a    EQU $+1:LD C,0:LDIR:LD L,A        SET 7,LHe2b    EQU $+1:LD C,0:LDIR:LD L,A        INC H        EXA:DEC A:JR NZ,HE2        LD (RSQBC),DE        JP MNG8R;-------RRESB   CALL GPOZA        EX DE,HL        LD L,(IX+8)        LD H,(IX+9)        LD A,H:CP #BF:RET NC:OR L:RET Z        PUSH HL        LD A,(IX+4),(He3a),A,(He3b),A        LD A,(IX+5)        EXA        LD A,RESB:CALL MNg8        LD A,E        EXA        LD B,0HE3     EXAHe3a    EQU $+1:LD C,0:LDIR:LD E,A        SET 7,EHe3b    EQU $+1:LD C,0:LDIR:LD E,A        INC D        EXA:DEC A:JR NZ,HE3        POP BC        EX DE,HL        LD HL,(RSQBC)        OR A:SBC HL,DE:JR Z,XeT;LD A,B,B,H,H,A;LD A,C,C,L,L,A;EX DE,HL;LDIR;LD BC,DE        JR XETXeT     LD (RSQBC),BCXET     CALL MNG8R        XOR A        LD (IX+8),A        LD (IX+9),A        RET;-------GPOZA   XOR A:CALL MNGC        LD HL,#C000        LD A,(IX+2):ADD A,L:LD L,A        LD A,(IX+3):ADD A,H:LD H,A        RET;---------------------------------------SWDMA   LD A,H        OR A:JR Z,WSDDN        DEC A:JR Z,WSDUP        RETWSDUP   CALL DMAMTCH:JP C,NWSD        LD HL,#0000        LD A,(IX+2):ADD A,L,A,E:LD L,A        LD A,(IX+3):ADD A,H,A,D:LD H,A        LD DE,BC:DEC D,D,E        XOR A        LD BC,DMADL:OUT L        LD B,DMADH[:OUT H        LD B,DMADX[:OUT A        LD B,DMASX[:OUT A:INC H        LD B,DMASL[:OUT L        LD B,DMASH[:OUT H        LD B,DMA_N[:OUT E        LD B,DMA_T[:OUT D        LD B,DMA_C[,A,%00110001:OUT A        INF:JP M,$-2        RET;-------WSDDN   CALL DMAMTCH:JR C,NWSD        LD HL,#0000        LD A,(IX+2):ADD A,L,A,E:LD E,A        LD A,(IX+3):ADD A,H,A,D,A,B        LD D,A:DEC D        LD HL,DE:DEC H        LD A,B:DEC A        EXA        LD A,C        LD BC,DMA_N:OUT A        XOR A        LD B,DMADX[:OUT A        LD B,DMASX[:OUT A        LD B,DMA_T[:OUT A        EXAZUPZUP  EXA        LD B,DMADL[:OUT E        LD B,DMADH[:OUT D:DEC D        LD B,DMASL[:OUT L        LD B,DMASH[:OUT H:DEC H        LD B,DMA_C[,A,%00000001:OUT A        INF:JP M,$-2        EXA:DEC A:JR NZ,ZUPZUP        RET;-------SCRLWOW ;i: D - Y;           E - X;           B - H;           C - W;           A - [7]: %1 - with attr;                    %0 - chars only;               [6]: %1 - clear src side;                    %0 - don't clear;             [5-2]: %0000 - 1 char step;                    %1111 - 16 chars;             [1-0]: %00 - down;                    %01 - up;                    %10 - right;                    %11 - left        LD H,A:AND %11111100:JP Z,SWDMANWSD    LD A,H        LD HL,ATTE+1,(HL),0        BIT 7,A:JR Z,$+4:LD (HL),1        LD HL,SWCL+1,(HL),0        BIT 6,A:JR Z,$+4:LD (HL),1        LD L,A        AND %00111100.2      RRA        INC A:LD (WSST+1),A        LD A,L        AND %00000011        OR A:JR Z,WSDN        DEC A:JR Z,WSUP        DEC A:JR Z,WSRGWSLF    RETWSRG    RETWSUP    CALL GPOZA        LD A,D:ADD A,H:LD H,A        LD A,E:ADD A,L:LD L,A        LD DE,HL        LD A,(WSST+1):ADD A,H:LD H,A        LD A,BWSST    SUB 0:RET C        LD B,AWSup    PUSH BC        PUSH HL,DE        LD A,C:EXA        LD B,0:LDIRATTE    LD A,0:OR A:JR Z,ATTD        SET 7,L        SET 7,E:DEC L,E        EXA:LD C,A:LDDRATTD    POP DE,HL:INC H,D        POP BC:DJNZ WSup        DEC HSWCL    LD A,0:OR A:RET Z        XOR A        LD B,C,(HL),A:INC L:DJNZ $-2        LD A,(ATTE+1):OR A:RET Z        SET 7,L        LD A,(IX+6)        LD B,C:DEC L:LD (HL),A:DJNZ $-2        RET;-------WSDN    CALL GPOZA        LD A,D:ADD A,H,A,B:LD H,A:DEC H        LD A,E:ADD A,L:LD L,A        LD DE,HL        PUSH BC        LD A,(WSST+1),C,A        LD A,H:SUB C:LD H,A        LD A,B:SUB C        POP BC:RET C        LD B,AWSdn    PUSH BC        PUSH HL,DE        LD A,C:EXA        LD B,0:LDIR        LD A,(ATTE+1):OR A:JR Z,ATTd        SET 7,L        SET 7,E:DEC L,E        EXA:LD C,A:LDDRATTd    POP DE,HL:DEC H,D        POP BC:DJNZ WSdn        INC H        JR SWCL;-------DMAMTCH LD A,(IX+2):ADD A,E:RRA:RET C        LD A,C:RRA        RET;---------------------------------------CURSOR  CALL SOR.2      DEC B:RET Z        LD A,(IX+1)        AND A,(HL)        OR (IX+14)        CP (HL):JR Z,CRS        LD C,(HL),(IX+15),CCRS     LD (HL),A:INC L:DJNZ $-2        RETCURSER  CALL SOR.2      DEC B:RET Z        LD A,(IX+15)        JR CRSSOR     CALL GPOZA:INC L        SET 7,L        LD A,(IX+12):ADD A,H:LD H,A        LD B,(IX+4)        RET;---------------------------------------PRSRW   ;i:IX - SOW;          HL - TEXT;          BC - Length;           D - Y;           E - X;        o:HL - Address        PUSH DE        PUSH HL        CALL GPOZA;INC H,L        LD A,D:ADD A,H:LD H,A        LD A,E:ADD A,L:LD L,A        EX DE,HL        POP HL        LD A,C        LDIR        LD B,A        EX DE,HL        POP DE        RET;-------PRIAT   ;i:HL - Address in SCREEN;           A - Color;           B - Lenght        SET 7,L        DEC L:LD (HL),A:DEC L:DJNZ $-2        RET;-------GADRW   ;i:IX - SOW;           D - Y;           E - X;        o:HL - Address        PUSH DE        CALL GPOZA        LD A,D:ADD A,H:LD H,A        LD A,E:ADD A,L:LD L,A        POP DE        RET;---------------------------------------;i: D - Y;   E - X;  HL - text addres;   A - message numberMEZZ    OR A:JR Z,TXTPR        PUSH DE        LD E,A        LD BC,8192BXX     XOR ABAX     CPIR        LD A,(HL):INC HL        OR A:JR NZ,BXX        DEC E:JR NZ,BAX        POP DE;---------------------------------------TXTPR   ;i:HL - Text;           E - X;           D - Y;        o: E - old X;           D - new Y        XOR A:CALL MNGC        LD (LXY),DE,A,(IX+6),(CLRN),ABTOOOM  LD A,(HL)        OR A:JR Z,LOOOL        CP 11:JR Z,TTAB        CP 12:JR Z,TTRA        CP 13:JP Z,NxtLine        CP 14:JR Z,CNTR        CP #FE:CALL Z,CybLnk:JR Z,BTOOOM        CP 10:CALL C,CCOD:JR C,BTOOOM        CALL CHAR        JP BTOOOMLOOOL   LD DE,(LXY):INC D        RETTTAB    INC HL:LD A,E:ADD A,(HL):LD E,A        INC HL:JR BTOOOMTTRA    INC HL:LD A,D:ADD A,(HL):LD D,A        INC HL:JR BTOOOMCNTR    PUSH HL        LD BC,#5000:CALL STSCN:JR NZ,CNt        LD A,C:OR A:JR Z,CNt        LD A,(IX+4):SUB C:JR C,CNt,Z,CNt        SRL A:LD E,ACNt     POP HL:INC HL:JR BTOOOMSTSCN   INC HL        LD A,(HL)        OR A:RET Z        CP 13:RET Z        CP 14:JR Z,BDCD        CP #FE:JR NC,BDCD        CP 16:JR C,$+3:INC C        CP 11:JR NZ,$+3:INC HL        CP 12:JR NZ,$+3:INC HL        DJNZ STSCNBDCD    LD A,#FE        OR A        RET;-------CHAR    PUSH HL        LD A,(HL)        EXA        LD HL,#C000        LD A,(IX+2):ADD A,L:LD L,A        LD A,(IX+3):ADD A,H:LD H,A        LD A,D:ADD A,H:LD H,A        LD A,E:ADD A,L:LD L,A        EXA:LD (HL),A        SET 7,L        LD A,(CLRN),(HL),A        POP HL        INC E,HL        RET;---------------------------------------NxtLine LD DE,(LXY):INC D,HL:JP TXTPR;-------CybLnk  INC HL        LD A,(HL):INC HL:EXA        LD A,(HL):INC HL        PUSH HL        LD H,A:EXA        LD L,A        CALL STRING        POP HL        XOR A        RETSTRING  LD A,(HL)        OR A:RET Z        CP 13:RET Z        CP 10:CALL C,CCOD:JR C,STRING        CALL CHAR        JP STRING;-------CCOD    CP 9:JR NZ,XA        LD A,(CLRN).4      RRCA        LD (CLRN),A        INC HL        SCF        RET;-------XA      EXA:INC HL:LD A,(HL):CP 9:JR C,X        EXA        AND 7:LD C,A        LD A,(IX+6):AND %11110000:OR C        LD (CLRN),A        SCF        RET;-------X       EXX        LD C,A:EXA        CP C:JR Z,BRO        DEC A,C.4      ADD A,A        OR CGGB     LD (CLRN),A:SCF        EXX        INC HL        RETBRO     OR %00001000        LD C,A,A,(IX+6):AND %11110000        OR C:JR GGB;---------------------------------------