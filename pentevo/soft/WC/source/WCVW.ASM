;---------------------------------------VIMG    EI:HALT        LD HL,0        LD (GOY),HL        LD (GOX),HL        CALL Vv        LD A,%11100010,(VVmod),A        LD D,GVvPG,E,GVvPG+9:CALL GROB        CALL GFXLOAD:JP NZ,GEDGFXM    EI:HALT        CALL UPPP,NZ,GUP        CALL DWWW,NZ,GDN        CALL RGGG,NZ,GRG        CALL LFFF,NZ,GLF        CALL ENKE:JR NZ,NXTFL        CALL SPKE:JP NZ,GED        CALL ESC:JR Z,GFXM        JP GED;-------NXTFL   CALL CRDN        JP VIEW;-------GUP     LD HL,(GOY),DE,GSTP        OR A:SBC HL,DE:RET CGGY     LD (GOY),HL        LD (VYofL),HL        RET;-------GDN     LD HL,(GOY),DE,GSTP        ADD HL,DE        LD DE,(GMY)        OR A:SBC HL,DE:RET NC        ADD HL,DE        JR GGY;-------GRG     LD HL,(GOX),DE,GSTP        ADD HL,DE        LD DE,(GMX)        OR A:SBC HL,DE:RET NC        ADD HL,DE        JR GGXGLF     LD HL,(GOX),DE,GSTP        OR A:SBC HL,DE:RET CGGX     LD (GOX),HL        LD (VXofL),HL        RET;-------GFFA    LD A,1:OR A        RET;-------GFXLOAD LD A,GVvPG,(GPGC),A:CALL MNGC        XOR A:LD (EOC),A        LD HL,LOBU        LD B,8:CALL LOAD512        LD A,(LOBU),(GDLA),A        LD HL,LOBU+1        LD A,(HL):OR A:JR Z,GFFA:INC HL        LD A,(HL):CP 1:RET NZ        LD HL,(LOBU+12)        LD DE,513        OR A:SBC HL,DE:JR NC,GFFA        LD HL,(LOBU+14)        OR A:SBC HL,DE:JR NC,GFFA        LD HL,LOBU+12        LD E,(HL):INC HL;W        LD D,(HL):INC HL        LD C,(HL):INC HL;H        LD B,(HL)        EX DE,HL        LD (GRAB+1),HL        LD (GRAA+1),BC        LD DE,360:CALL GWH:LD (GMX),HL        LD HL,BC        LD DE,288:CALL GWH:LD (GMY),HL        LD A,%00010000:CALL PABE+2        LD HL,LOBU+18,DE,(GDLA)        ADD HL,DE:LD DE,0:CALL PALCNV        CALL PAED        EI:HALT        LD A,GVvPG,(VVpag),A        LD A,%11000010,(VVmod),A        LD HL,LOBU+786        LD DE,(GDLA):ADD HL,DE        LD DE,#C000GRAB    LD BC,0        LDIR        EX DE,HL        LD A,L:OR A:JR Z,GGGGln     LD (HL),C:INC L:JP NZ,Gln:INC HGGG     BIT 0,H:JR NZ,Gln        EX DE,HLGRAA    LD BC,0,A,B:OR C:RET Z        DEC BC:LD (GRAA+1),BC        LD A,D:OR A:CALL Z,GPGN:RET Z        LD A,H:CP LOBU[+#0E:JR C,GRAB        LD A,(EOC):CP #0F:RET Z        PUSH HL,DE        LD A,#02        LD HL,LOBU+#0E00-#8000        LD DE,LOBU-#8000        LD BC,DMASL:OUT L        LD B,DMASH[:OUT H        LD B,DMASX[:OUT A        LD B,DMADL[:OUT E        LD B,DMADH[:OUT D        LD B,DMADX[:OUT A        LD B,DMA_T[:XOR A:OUT A        LD B,DMA_N[,A,255:OUT A        LD B,DMA_C[,A,%00000001:OUT A        LD B,STS[:INF:JP M,$-2        LD HL,LOBU+#0200        LD B,7:CALL LOAD512:LD (EOC),A        POP DE,HL        LD A,H:SUB #0E:LD H,A        JR GRABGPGN    LD A,(GPGC):INC A        LD (GPGC),A        CP GVvPG+16:JR NC,GPE        CALL MNGC        LD A,#C0:ADD A,D:LD D,A        LD A,1:OR A        RETGPE     XOR A        RET;-------PALCNV  EXX        LD E,0        EXX        LD B,0        LD A,(CNFv):OR A:JR NZ,CNV2CNV     PUSH BC        LD A,(HL):INC HL:CALL DEL10        LD A,C        EXX:LD L,A,H,E        EXX        LD A,(HL):INC HL:CALL DEL10        LD A,C        EXX:LD B,E,C,A.5      SLA C:RL B        ADD HL,BC        EXX        LD A,(HL):INC HL:CALL DEL10        LD A,C        EXX.2      SLA A        OR H:EXA:LD A,L        EXX        LD (DE),A:INC DE        EXA        LD (DE),A:INC DE        POP BC        DJNZ CNV        RETCNV2    PUSH BC        LD A,(HL):INC HL.3      SRL A        EXX:LD L,A,H,E        EXX        LD A,(HL):INC HL.3      SRL A        EXX:LD B,E,C,A.5      SLA C:RL B        ADD HL,BC        EXX        LD A,(HL):INC HL.3      SRL A        EXX.2      SLA A        OR H:EXA:LD A,L        EXX        LD (DE),A:INC DE        EXA        OR %10000000        LD (DE),A:INC DE        POP BC        DJNZ CNV2        RETDEL10   LD BC,#0AFFDEL     INC C        SUB B:RET C        JP DELGWH     OR A:SBC HL,DE:RET NC        LD HL,0        RET;-------GROB    EI:HALT        LD A,D:CALL MNGC        LD HL,0,(#C000),HL        LD BC,DMASL:OUT L:INC L,L        LD B,DMASH[:OUT H        LD B,DMASX[:OUT A        LD B,DMADL[:OUT L        LD B,DMADH[:OUT H        LD B,DMADX[:OUT A        LD B,DMA_N[,A,255:OUT A        LD B,DMA_T[,A,31:OUT ABOB     LD B,DMA_C[,A,%00000100:OUT A        LD B,STS[:INF:JP M,$-2        INC D:LD A,D:CP E:JR C,BOB        RET;---------------------------------------VMG     LD A,GVvPG,(GPGC),A        LD A,GV2PG:CALL MNGC        LD HL,#CB00,B,#25:CALL LOAD512        LD HL,#CC00,DE,#C000        LD A,(#CB00+4)        CP 2:JR Z,MG2        CP 4:JR Z,MG4        CP 8:JP NZ,GED        LD BC,#1800:LDIR        LD DE,#C000+#1B00        LD BC,#1800:LDIR        LD DE,#C000+#1800        LD BC,#0300:LDIR        LD DE,#C000+#1B00+#1800        LD BC,#0300:LDIR        JP OCCMG4     LD BC,#1800:LDIR        LD DE,#C000+#1E00        LD BC,#1800:LDIR        LD DE,#C000+#1800        LD BC,#0600:LDIR        LD DE,#C000+#1E00+#1800        LD BC,#0600:LDIR        LD A,#1E        LD (U1+2),A        LD (U2+2),A        LD A,4        LD (U3+1),A        LD HL,GSCGB2        LD (U4+1),HL        JP OCCMG2     LD BC,#1800:LDIR        LD DE,#C000+#2400        LD BC,#1800:LDIR        LD DE,#C000+#1800        LD BC,#0C00:LDIR        LD DE,#C000+#2400+#1800        LD BC,#0C00:LDIR        LD A,#24        LD (U1+2),A        LD (U2+2),A        LD A,2        LD (U3+1),A        LD HL,GSCGB3        LD (U4+1),HL        JP OCCVZAD    LD A,#1B        LD (U1+2),A        LD (U2+2),A        LD A,8        LD (U3+1),A        LD HL,GSCGB        LD (U4+1),HL        RETMGBRD   LD A,(#CB00+5):AND %00000111        LD C,A        LD A,(#CB00+6):AND %00000111.4      SLA A        OR C        LD BC,BORDER:OUT A        RETGSCGB2  PUSH AF        PUSH BC        CALL ZNAK_LD A,E:ADD A,32:JR NC,$+3:INC D:LD E,A        CALL ZNAK        EX DE,HL        LD BC,31:OR A:SBC HL,BC        EX DE,HL        POP BC.8      INC BC        LD A,H:SUB 8:LD H,A        INC L        POP AF        DEC A:JR NZ,GSCGB2        EX DE,HL        LD DE,32:ADD HL,DE        EX DE,HL        RETGSCGB3  PUSH AF        PUSH BC        CALL ZNAK_LD A,E:ADD A,32:JR NC,$+3:INC D:LD E,A        CALL ZNAK_LD A,E:ADD A,32:JR NC,$+3:INC D:LD E,A        CALL ZNAK_LD A,E:ADD A,32:JR NC,$+3:INC D:LD E,A        CALL ZNAK        EX DE,HL        LD BC,95:OR A:SBC HL,BC        EX DE,HL        POP BC.8      INC BC        LD A,H:SUB 8:LD H,A        INC L        POP AF        DEC A:JR NZ,GSCGB3        EX DE,HL        LD DE,96:ADD HL,DE        EX DE,HL        RET;-------VSC2    CP #11:JP NZ,EXTSEL:LD A,C        CP #1B:JP NZ,EXTSEL        LD A,GVvPG:CALL MNGC        LD HL,#BFEF,B,#0E:CALL LOAD512        JR SC2VSCR    LD A,GVvPG:CALL MNGC        LD HL,#C000,B,#0E:CALL LOAD512SC2     DI        LD A,GVvPG,(VVpag),A        XOR A:LD (VVmod),A        CALL DDDSSSR    EI:HALT        CALL ENKE:JP NZ,NXTFL        CALL ESC:JP NZ,GED        CALL SPKE:JR Z,SSSR        JP GED;-------VGS     LD HL,ARRR+3        LD A,(HL):DEC HL        OR (HL):DEC HL:JP NZ,EXTSEL        LD C,(HL):DEC HL        OR (HL):JR NZ,VSC2        LD A,C        CP #1B:JR Z,VSCR        CP #1B*2:JP NZ,EXTSEL        LD A,GVvPG,(GPGC),A        LD A,GV2PG:CALL MNGC        LD HL,#C000,B,#1B:CALL LOAD512OCC     EI:HALT        CALL Vv        LD A,%00100010,(VVmod),A        LD A,GVvPG,(VVpag),A        LD D,GVvPG,E,GVvPG+6:CALL GROB        LD A,%00011011        CALL PABE+2_LD HL,GIG_PAL,DE,#B000,BC,512:LDIR        CALL PAED        LD A,%00000010,(VVmod),A;-------        LD HL,ZXADR,DE,#D800        EXX        LD BC,DMA_T,A,7:OUT A        XOR A        LD B,DMADL[:OUT A        LD B,DMADH[:OUT A        LD A,(GPGC)        LD B,DMADX[:OUT A        LD B,6*4SSR     PUSH BC        EXX        LD A,GV2PG:CALL MNGC        LD C,(HL):INC HL        LD B,(HL):INC HL        PUSH HL        LD HL,BC        LD BC,LOBU,A,32U4      CALL GSCGB        POP HL        EXX        LD A,#02        LD DE,LOBU-#8000        LD BC,DMASL:OUT E        LD B,DMASH[:OUT D        LD B,DMASX[:OUT A        LD B,DMA_N[,A,255:OUT A        LD B,DMA_C[,A,%00000001:OUT A        LD B,STS[:INF:JP M,$-2        POP BC        DJNZ SSR        CALL VZAD        JP SSSR;-------GSCGB   PUSH AF        PUSH BC        CALL ZNAK:INC DE        POP BC.8      INC BC        LD A,H:SUB 8:LD H,A        INC L        POP AF        DEC A:JR NZ,GSCGB        RET;-------ZNAK    PUSH BC        EX DE,HL        LD A,(HL)        EXX        LD L,A:AND %01111000.3      SRL A        LD H,A:AND %00001000        LD (HAT+1),A        LD A,L:AND %00000111HAT     OR %00000000        LD L,A        EXXU1      LD BC,#1B00:ADD HL,BC        LD A,(HL)        EXX        LD C,A:AND %01111000:SLA A        LD B,A:AND %10000000        LD (HAt+1),A        LD A,C:AND %00000111.4      SLA AHAt     OR %00000000        LD C,A        EXX        OR A:SBC HL,BC        EX DE,HL        POP BCU3      LD A,8        PUSH DEUr      EXAU2      LD DE,#1B00        SLA (HL)        EXX:LD A,H:JR NC,$+3:LD A,L        EXX:ADD HL,DE        SLA (HL)        EXX:LD E,B:JR NC,$+3:LD E,C:OR E        EXX:SBC HL,DE        LD (BC),A:INC C        SLA (HL)        EXX:LD A,H:JR NC,$+3:LD A,L        EXX:ADD HL,DE        SLA (HL)        EXX:LD E,B:JR NC,$+3:LD E,C:OR E        EXX:SBC HL,DE        LD (BC),A:INC C        SLA (HL)        EXX:LD A,H:JR NC,$+3:LD A,L        EXX:ADD HL,DE        SLA (HL)        EXX:LD E,B:JR NC,$+3:LD E,C:OR E        EXX:SBC HL,DE        LD (BC),A:INC C        SLA (HL)        EXX:LD A,H:JR NC,$+3:LD A,L        EXX:ADD HL,DE        SLA (HL)        EXX:LD E,B:JR NC,$+3:LD E,C:OR E        EXX:SBC HL,DE        LD (BC),A:INC C        SLA (HL)        EXX:LD A,H:JR NC,$+3:LD A,L        EXX:ADD HL,DE        SLA (HL)        EXX:LD E,B:JR NC,$+3:LD E,C:OR E        EXX:SBC HL,DE        LD (BC),A:INC C        SLA (HL)        EXX:LD A,H:JR NC,$+3:LD A,L        EXX:ADD HL,DE        SLA (HL)        EXX:LD E,B:JR NC,$+3:LD E,C:OR E        EXX:SBC HL,DE        LD (BC),A:INC C        SLA (HL)        EXX:LD A,H:JR NC,$+3:LD A,L        EXX:ADD HL,DE        SLA (HL)        EXX:LD E,B:JR NC,$+3:LD E,C:OR E        EXX:SBC HL,DE        LD (BC),A:INC C        SLA (HL)        EXX:LD A,H:JR NC,$+3:LD A,L        EXX:ADD HL,DE        SLA (HL)        EXX:LD E,B:JR NC,$+3:LD E,C:OR E        EXX:SBC HL,DE        LD (BC),A        INC B,B        LD A,C:SUB 7:LD C,A        INC H        EXA:DEC A:JP NZ,Ur        POP DE        RET;---------------------------------------EXTZEL  CALL GETEN:RET Z        LD HL,BRRR:CALL GIPAGEXTSEL  CALL GED        PUSH IX        POP HL        LD DE,WINDC,BC,30:LDIR        PUSH IX        LD IX,WINDC        LD (IX+1),0.2      INC (IX+2)        LD A,(IX+3)        ADD A,(IX+12)        SUB 3:JR NC,$+3:XOR A        LD (IX+3),A        LD (IX+4),19+2        LD (IX+5),4+2        LD (IX+6),%01001111        LD (IX+8),B        LD (IX+9),B        LD (IX+10),B        LD (IX+11),B        LD A,(EXTN),(IX+12),A        LD (IX+13),4        LD (IX+14),%11110000        CALL PRWOW_LD HL,TBIN,DE,#0101,BC,19:CALL PRSRW_LD HL,TTXT,DE,#0201,BC,19:CALL PRSRW_LD HL,TSCR,DE,#0301,BC,19:CALL PRSRW_LD HL,TTGA,DE,#0401,BC,19:CALL PRSRWET      EI:HALT:CALL CURSOR        CALL UPPP,NZ,CrUP        CALL DWWW,NZ,CrDN        CALL ENKE:JR NZ,ES        CALL ESC:JR Z,ET        CALL RRESB        POP IX        RET;-------ES      CALL RRESB:LD A,(IX+12),(EXTN),A        POP IX        LD A,(WINDC+12)        DEC A:JP Z,VBIN        DEC A:JP Z,RE        DEC A:JP Z,VGS        JP VIMG;-------CHEXT   LD A,(DE):OR A:RET Z        CP (HL):JR NZ,HE        INC HL,DE        LD A,(DE):CP (HL):JR NZ,H2        INC HL,DE        LD A,(DE):CP (HL):JR Z,S7        DEC HL,DEH2      DEC HL,DEHE      INC DE,DE,DE,DE,DE        JR CHEXTS7      INC DE:LD A,(DE),L,A        INC DE:LD A,(DE),H,A        LD A,1:OR A        RETCHext   LD BC,0,(HE),BC        CALL CHEXT        LD BC,#1313,(HE),BC        RET;-------HEoff   EQU LOBU+3H2off   EQU HEoff+8+2H3off   EQU H2off+16+2VBIN    CALL REK        CALL ATTGN        LD HL,LOBU,B,128:CALL NOPING        LD A,"#"        LD (HEoff-1),A        LD A,#BA        LD (HEoff-3),A        LD (H3off+48),A        LD A,#B3        LD (H2off-1),A        LD (H3off-2),A        LD HL,0        LD (CURD),HL        LD (CURU),HL        CALL PGPRB,THEMBI     EI:HALT        CALL UPPP,NZ,CRBUP        CALL DWWW,NZ,CRBDN        CALL SPKE:JP NZ,GED        CALL ESC:JR Z,MBI        JP GED;-------GUPB    OR A:SBC HL,BC:JR NC,GUP_        LD A,(CUPG):DEC A:LD (CUPG),AGUP_    LD A,H:CP #C0:JR NC,GUPP        LD A,(CUPG):DEC A        CP TVBPG:RET C:LD (CUPG),A        LD A,H:ADD A,#40:LD H,AGUPP    LD (THL),HL        PUSH HL        LD HL,(CURD),DE,(CURU)        OR A:SBC HL,BC:JR NC,$+3:DEC DE        LD (CURD),HL,(CURU),DE        POP HL        XOR A        RETCRBUP   LD HL,(THL),A,(CUPG),(CUPU),A        PUSH HL        PUSH HL        LD HL,(HEI),BC,16,H,B.4      ADD HL,HL        ADD HL,BC        LD BC,HL        POP HL        CALL GUPB:JR C,BUpp        LD A,0-1        CALL YoRN        CALL ZBUB        CALL HGIR        LD HL,(HEI),H,0.4      ADD HL,HL        LD BC,HL        LD HL,(CURD),DE,(CURU)        ADD HL,BC:JR NC,$+3:INC DE        LD (CURD),HL,(CURU),DE        POP HL        LD A,(CUPU),(CUPG),A        LD BC,16:CALL GUPB        LD HL,(Yoff),DE,(YoX):ADD HL,DE        EX DE,HL        JP YoCHBUpp    POP HL        RET;-------CRBDN   LD DE,(LNFL),HL,(LNFL+2)        LD BC,(CURU)        OR A:SBC HL,BC:RET C        EX DE,HL        LD BC,(CURD)        OR A:SBC HL,BC:JR NC,RBN        DEC DE        INC E:JR NZ,RBN        INC D:RET ZRBN     LD HL,(THL)        LD A,(HEI)        CALL YoRN        CALL ZBUB        CALL HGIR        LD DE,(Yoff).8      INC DE        JP YoCH;-------PGPRB   LD BC,(HEI-1),HL,#C000,DE,#C000BCD     PUSH BC        CALL ZBUB        CALL HGIR        LD HL,(THL)        POP BC        DJNZ BCD        RETZBUB    PUSH DE        LD A,(CUPG):CALL MNGC        LD A,H:CP #C0:JR NC,BUB        LD A,(CUPG):INC A        CP TVEPG+1:JR NC,BuB        LD (CUPG),A:CALL MNGC        LD HL,#C000BUB     LD DE,H2off,BC,16:LDIR        LD (THL),HL        LD DE,H2off,HL,H3off,B,4B_B.4      LD A,(DE):CALL NORK:INC L,E        DJNZ B_B        LD HL,HEoff        LD DE,(CURU)        LD A,D:CALL NORK        LD A,E:CALL NORK        LD DE,(CURD)        LD A,D:CALL NORK        LD A,E:CALL NORK        LD DE,(CURU)        LD HL,(CURD),BC,16        ADD HL,BC:JR NC,$+3:INC DE        LD (CURD),HL        LD (CURU),DE        LD A,TVvPG:CALL MNGC        LD HL,LOBU,BC,80BuB     POP DE        RETHGIR    LDIR:INC D:LD E,0        RET;-------ATTGN   LD A,TVvPG:CALL MNGC        LD A,%00000101        LD HL,#C080        EXX        LD B,64ATGN    EXX_LD A,%00011111,(HL),A:INC L_LD A,%00010111,B,11:CALL NOPING+1        LD A,%00011111,(HL),A:INC L        LD B,8        LD (HL),%00010111:INC L        LD (HL),%00010101:INC L        DJNZ $-6        LD A,%00011111,(HL),A:INC L        LD A,%00010000,(HL),A:INC L        LD C,8ATG     LD A,%00010111,B,3:CALL NOPING+1        LD A,%00010101,B,3:CALL NOPING+1        LD A,%00011111,(HL),A        DEC C:JR NZ,ATG        INC H:LD L,#80        EXX        DJNZ ATGN        RET;-------VIEW    CALL GETEN:JP Z,GEDVIE     LD HL,BRRR:CALL GIPAG        CALL GOPLG        OR A:JP Z,GED        DEC A:JR Z,VIK        DEC A:JP Z,NXTFLVIK     LD HL,ENTRY+8        LD DE,EXTZ        CALL CHEXT:JP Z,EXTSEL,(HL)RE      CALL REK        PUSH IX        LD IX,TVWND:CALL PRWOW        CALL PGPRREMAIN  EI:HALT        CALL UPPP,NZ,TVUP        CALL DWWW,NZ,TVDN        CALL PGU,NZ,TVPGUP        CALL PGD,NZ,TVPGDN        CALL SPKE:JR NZ,REEX        CALL ESC:JR Z,REMAINREEX    CALL RRESB        POP IX        RET;-------TVPGUP  LD HL,(CURU)        LD B,(IX+5):DEC BPUP     PUSH BC:LD BC,CUPU:CALL SERUP        POP BC:JR C,TVup        DJNZ PUP        LD (CURU),HL        JP PGPRTVPGDN  CALL DWNF:RET Z        LD (CURU),HL        LD A,(CUPG),(CUPU),A        JP PGPR;-------TVup    LD HL,#C000,(CURU),HL:JP PGPRTVUP    LD HL,(CURU),BC,CUPU        CALL SERUP:JR C,TVup        LD (CURU),HL        LD HL,EDFL,A,(HL)        OR A:JR Z,$+5:DEC (HL):JR NZ,M3        LD HL,(CURD),BC,CUPG        CALL SERUP        LD (CURD),HLM3      LD B,(IX+5):DEC B        LD C,80        LD DE,#0100        LD A,%00000000:CALL SCRLWOW        LD DE,#0100        LD HL,(CURU),(THL),HL:JP LNPRU;-------DWNF    LD A,(CUPG):CALL MNGC        LD HL,(CURD),A,(HL):OR A        RETTVDN    CALL DWNF:RET Z        LD B,(IX+5):DEC B        LD C,80        LD DE,#0100        LD A,%00000001:CALL SCRLWOW        LD E,0        LD D,(IX+5):DEC D        LD HL,(CURD),(THL),HL:CALL LNPR        LD HL,(THL),(CURD),HL        LD A,(CUPG)        PUSH AF        LD A,(CUPU),(CUPG),A:CALL MNGC        LD HL,(CURU):CALL SERDN        LD (CURU),HL        LD A,(CUPG),(CUPU),A        POP AF        LD (CUPG),A        RET;-------PGPR    XOR A:LD (EDFL),A        LD A,(CUPU),(CUPG),A        LD HL,(CURU),(THL),HL        LD B,(IX+5):DEC B        LD DE,#0100MNC     PUSH DE,BC        CALL LNPR        LD A,(CUPG):CALL MNGC        LD HL,(THL),A,(HL)        OR A:CALL Z,ZERL        POP BC,DE:INC D:DJNZ MNC        LD HL,(THL),(CURD),HL        RETZERL    LD HL,EDFL:INC (HL):RET;-------LNPRU   LD A,(CUPG)        PUSH AF        LD A,(CUPU),(CUPG),A:CALL LNPR        POP AF        LD (CUPG),A        RETLNPR    LD A,(CUPG):CALL MNGC        EXX        LD HL,(THL)        LD DE,LOBU:CALL LIGEN        LD (THL),HL:CALL LIFIL        EXX        LD HL,LOBU,B,0,C,(IX+4):JP PRSRWLIGEN   LD BC,#0D0A        LD A,H:OR A:CALL Z,A440        LD A,(HL):OR A:RET Z        CP B:JR NZ,$+3:INC HL        LD A,H:OR A:CALL Z,A440        LD A,(HL)        CP C:JR NZ,$+3:INC HLLILI    LD A,H:OR A:CALL Z,A440        LD A,D:CP LOBU[+4:RET NC        LD A,(HL):OR A:RET Z        CP B:RET Z        CP C:RET Z:INC HL        LD (DE),A:INC DE        JP LILILIFIL   LD A,D:CP LOBU[+1:RET NC        LD A,E:SUB 80:RET NC        EX DE,HL        NEG:LD B,A:JP NOPINGCRPR    RET;-------SERDN   LD BC,#0D0A        LD A,H:OR A:CALL Z,A440        LD A,(HL):OR A:RET Z        CP B:JR NZ,$+3:INC HL        LD A,H:OR A:CALL Z,A440        LD A,(HL)        CP C:JR NZ,$+3:INC HLLILI2   LD A,H:OR A:CALL Z,A440        LD A,(HL):OR A:RET Z        CP B:RET Z        CP C:RET Z:INC HL        JP LILI2;-------SERUP   LD (A440U+1),BC,A,(BC):CALL MNGC        LD BC,#0D0ASERup   DEC HL        LD A,H:CP #C0        CALL C,A440U:RET C        LD A,(HL)        CP B:RET Z        CP C:JR NZ,SERup        DEC HL        LD A,H:CP #C0        CALL C,A440U:RET C        LD A,(HL):CP B:RET Z        INC HL        LD A,H:OR A:CALL Z,A440D        RET;-------A440D   LD HL,(A440U+1):JR $+5A440    LD HL,CUPG:INC (HL)        LD A,(HL):CALL MNGC        LD HL,#C000        RETA440U   LD HL,0        LD A,(HL):DEC A:CP TVBPG:RET C        LD (HL),A:CALL MNGC        LD HL,#FFFF        XOR A        RET;-------SER13D  LD C,13SER     LD A,(HL)        OR A:RET Z:INC HL        CP C:RET Z        JP SER;---------------------------------------REK     LD HL,ARRR,DE,LNFL,BC,4:LDIR        LD HL,0        LD (Yoff),HL        LD (YoX),HL        LD A,TVBPG        LD (CUPG),A        LD (CUPU),A        LD HL,#C000,(CURU),HL        CALL TLOAD:LD A,TVBPG,(CUPG),A        RET;-------TLOAD   LD A,(CUPG):CP TVEPG+1:RET NC        CALL MNGC        LD HL,#C000,B,32:CALL LOAD512        CP #0F:RET Z        LD HL,CUPG:INC (HL)        JR TLOAD;---------------------------------------THE     DI        LD A,TVvPG,(VVpag),A:CALL DED        RETYoCH    LD A,D:AND %00111111        LD (VYofL),DE        LD (Yoff),DE        RETYoRN    PUSH AF        LD DE,(Yoff)        RRC D:RR E.2      SRL E        ADD A,E        AND %00111111        ADD A,#C0        LD D,A        LD E,0        POP AF        PUSH HL        LD L,A,H,0        CP #80:JR NC,YoN.3      SLA L:RL HYoR     LD (YoX),HL        POP HL        RETYoN     XOR A:SUB L:LD L,A.3      SLA L:RL H        PUSH BC        LD BC,HL,HL,0:OR A:SBC HL,BC        POP BC        JR YoR;---------------------------------------FSM     CALL GED        PUSH IX        LD HL,F5WND,DE,WINDC,BC,30:LDIR        LD IX,WINDC        LD (IX+2),30        LD (IX+3),10        LD (IX+4),18+2        LD (IX+5),6+2        LD (IX+12),1        LD (IX+13),4        LD (IX+14),%11110000:CALL PRWOW_LD HL,TXTA,DE,#0005,BC,9:CALL PRSRW        LD A,%11110111:CALL PRIAT_LD HL,TF35,DE,#0105,BC,8:CALL PRSRW_LD HL,TF70,DE,#0205,BC,8:CALL PRSRW_LD HL,TF14,DE,#0305,BC,8:CALL PRSRW_LD HL,TF14O,DE,#0405,BC,8:CALL PRSRW        LD A,1:CALL YNMSPG    EI:HALT:CALL CURSOR        XOR A:CALL YN        CALL UPPP,NZ,CrUP        CALL DWWW,NZ,CrDN        CALL ESC:JR NZ,CSPG        CALL ENKE:JR Z,MSPG;-------        LD A,#FF:CALL YN:JR NZ,CSPG        LD A,(IX+12)        LD C,0        DEC A:JR Z,AS        LD C,1        DEC A:JR Z,AS        LD C,2        DEC A:JR Z,AS        LD C,3AS      LD A,C,(BOF),A        CALL RRESB        POP IX        LD A,1:OR A        RET;-------CSPG    CALL RRESB        POP IX        XOR A        RET;---------------------------------------RUNHOB  CALL FSM:RET Z        LD HL,#0200,B,1:CALL LOAD512        LD HL,(#020B),A,H:CP #A0:RET NC        LD DE,(#0209),A,D:CP #60:RET C        EXX        LD A,%00100000,(VVmod),A        CALL DINT        XOR A:CALL MNGC,TURBOof        LD HL,HOBAT,DE,#5B00,BC,96:LDIR        LD HL,MNG0D,DE,#5B60,BC,32:LDIR        EXX        LD HL,512-17:ADD HL,DE        PUSH DE        JP #5B00HOBAT   PUSH DETHG     LD A,H:CP #60:JR C,THg        LD B,1:CALL LOAD512        CP #0F:JR NZ,THGTHg     POP DE        LD HL,#0200+17,BC,512-17:LDIR        DI        LD A,63,I,A:IM 1        LD IY,#5C3A        LD HL,#5800,DE,HL:INC DE        LD BC,#0300-1,(HL),L:LDIR        LD BC,Vmod:XOR A:OUT A        CALL #5B60        LD BC,#7FFD,A,16:OUT A        RET;---------------------------------------K       EQU #0000MLZP    EQU #0D00HRSP    EQU #0E00LOB3    EQU #1000;-------SPG1    ;SPGv1.0        CP #10:JP NZ,GED        LD A,%00100000,(VVmod),A        CALL DINT        LD A,D5PG:CALL MNGC        LD HL,#C000,DE,HL:INC DE        LD (HL),L,BC,#4000-1:LDIR        LD HL,(LOB2+#30),(SPG_SA+1),HL        LD HL,(LOB2+#32),(SPG_SP+1),HL        LD HL,(LOB2+#38),(SPG_RZ+1),HL        LD A,(LOB2+#34),(SPG_PG+1),A        LD A,(LOB2+#35)        LD C,A        AND %00000011:LD (BOF),A        LD A,C:AND %00000100        LD A,#F3:JR Z,$+4:LD A,#FB;EI        LD (SPG_IT),A        LD HL,LOB2,DE,LOB3,BC,1024:LDIR        LD HL,SPGRZ,DE,K,BC,Y-SPGRZ:LDIR        LD HL,MLZ4,DE,MLZP,BC,256:LDIR        LD HL,DEHR1,DE,HRSP,BC,512:LDIR        JP K;-------SPGRZ   LD IX,LOB3+256        LD A,DBPG:CALL MNG8        LD B,0KOVR    LD A,(IX):INC IX        LD C,A        AND %00011111:ADD A,A,A,#C0        LD H,A        LD L,0        INC IX        LD A,(IX):INC IX        CP #02:JR NZ,$+4:LD A,D2PG        CP #05:JR NZ,$+4:LD A,D5PG        CALL MNGC        LD A,(IX-2)        LD E,A:AND %11000000.2      RLCA        LD D,A        LD A,E:AND %00011111:INC A        PUSH BC,IX        LD B,A        LD A,D:OR A:JR NZ,SPGPKD        CALL LOAD512PKDE    POP IX,BC        LD A,C        AND %10000000:JR NZ,ARBLKZ        DJNZ KOVR        JR ARBLKZ;-------SPGPKD  DEC A:JR Z,SPGMLZSPGHRS  PUSH HL:LD HL,#8000:CALL LOAD512        POP DE        DI        LD (SPBU),SP        LD IX,#8000        CALL HRSPSPGPE   LD SP,(SPBU)        JR PKDESPGMLZ  PUSH HL:LD HL,#8000:CALL LOAD512        POP DE        DI        LD (SPBU),SP        LD HL,#8000        CALL MLZP        JR SPGPE;-------ARBLKZ  LD A,D2PG:CALL MNG8        LD A,2:CALL MNGC        LD HL,#8000,DE,#C000        LD BC,#4000:LDIR        DI:CALL TURBOof        LD A,D5PG:CALL MNG8        LD A,5:CALL MNGC        LD HL,#8000,DE,#C000        LD BC,#4000:LDIR        LD BC,Vpag,A,5:OUT A        LD BC,Vmod:XOR A:OUT A        LD A,63,I,A:IM 1SPG_PG  LD A,0,BC,PW4:OUT A        LD A,2,B,PW2[:OUT A        LD A,5,B,PW1[:OUT A        LD HL,SPGRZD-SPGRZ+K        LD DE,(SPG_RZ+1-SPGRZ+K)        LD BC,16:LDIR        LD HL,#2758:EXX        LD IY,#5C3A        LD BC,DMA_T:XOR A:OUT ASPG_SA  LD HL,0SPG_SP  LD SP,#6000SPG_RZ  JP 0;-------SPGRZD  LD BC,PE0,A,%00000001:OUT A        LD B,PW0[,A,BASIC48:OUT ASPG_IT  DI        JP (HL)Y;---------------------------------------PAGER   EQU #5300LOB2    EQU #B000;-------RUNSPG  LD HL,LOB2,B,2:CALL LOAD512        LD HL,LOB2+32,DE,IDNT,B,12        CALL RAZ:JP NZ,GED        LD A,(HL):CP 3:JP NC,SPG1        CP 2:JR C,OF4;SPGv0.2:        LD A,15,(VrS+1),A        LD A,16,(V2A+1),A,(V2F+1),A        LD A,4,(V2B+1),A        LD A,15,(V2C+1),A;SPGv0.0/0.1:OF4     ;HL,SPGLOG:CALL SPGLOG        CALL FSM:RET Z:CALL TURBOof        LD A,%00100000,(VVmod),A        CALL DINT        LD HL,LOB2+1024,B,2:CALL LOAD512        LD HL,LOB2,DE,PAGER,BC,#0800        LDIR        LD HL,MANAG0,DE,PAGER,BC,32:LDIR        XOR A:CALL MNGC;-------V2A     LD A,8,(STUS),A;        COUNTER!        LD HL,(PAGER+64),(SAR+1),HL        LD A,(PAGER+66),(SPA+1),A        LD HL,(PAGER+74)        LD A,H:CP #40:JR NC,NSPZ        LD HL,(SPBU)NSPZ    LD (SSPA+1),HL        LD HL,(PAGER+68),(V2E+1),HL        LD HL,(PAGER+76)        LD A,H:OR L:JR Z,V2Di        LD (V2D+1),HLV2Di    LD BC,(PAGER+78)        LD A,B:OR C:JR Z,MAA        LD A,B:OR A:JR Z,MAA:LD B,1        LD A,C:CP #41:JR C,MAA:LD C,0MAA     LD (LAA+1),BC        LD IX,PAGER+128GROP    LD A,(IX+2):CP 14:JR C,NSPL        LD A,13NSPL    LD (SPGL+1),A;LD A,1,(PAUS),A        LD A,(IX+3)VrS     AND 7        CALL MNGC        LD HL,PAGER+512,E,(IX),D,(IX+1)        LD BC,#0600        CALL LC        EX DE,HL        LD A,H:CP #A0:JR C,DIPL        PUSH IXSPGL    LD B,1:SLA B,B        LD A,B:OR A:CALL NZ,LOAD512        POP IXV2B     LD DE,8:ADD IX,DE        LD A,(STUS):DEC A        LD (STUS),A:JR NZ,GROP;-------DIPL    DI        LD A,63,I,A:IM 1        LD IY,#5C3A        LD BC,Vmod:XOR A:OUT A        CALL MNG0D        LD BC,#7FFD,A,16:OUT A;LD HL,#5800,DE,#5801,BC,#02FF;LD (HL),L;LDIR        LD HL,PAGERV2E     LD DE,0        LD BC,32        LDIRLAA     LD BC,0,A,B:OR C:JR Z,SPA        LD HL,PAGER+192V2D     LD DE,#5B00        LDIRSPA     LD A,0V2C     AND 7        CALL PAGER;LD A,(PAGER+67);CP 1:JR NZ,NNx;LD A,(DRVE),(#5CF6),ANNx     LD A,(V2C+1):CP 7:JR Z,SSPA        LD HL,PAGER+49,E,5OUTZ    LD C,(HL):INC HL        LD B,(HL):INC HL        LD A,B:OR C:JR Z,OUTz        LD A,(HL)        OUT AOUTz    INC HL        DEC E:JR NZ,OUTZSSPA    LD SP,0SAR     JP 0;-------LC      LD A,(STUS)V2F     CP 8:RET NZ        LD A,D:CP #A0:JR NC,V01        LD (SREZ+4),DE        ADD A,6:LD D,A        PUSH DE        LD HL,(SAR+1),(SR1+1),HL        LD DE,PAGER+#20,(SAR+1),DE        LD HL,SREZ,BC,16:LDIR        POP DE        RETV01     LDIR        RETSREZ    LD HL,PAGER+512        LD DE,0        LD BC,#0600        LDIRSR1     JP 0;-------MANAG0  ;I:A - num of PAGE (VALID: 0-15)        PUSH BC        LD BC,PW4:OUT A        POP BC        RET;---------------------------------------PLER    LD HL,TER4:JP ERR0;---------------------------------------LDPLG   CALL GED:XOR ALDPL2   LD (PPFR),A        LD HL,LOBU,B,1:CALL LOAD512        LD A,(LOBU+32)        CP #02:JR C,PLER        CP #07:JR NC,PLER        LD HL,IDNT2,DE,LOBU+16,B,16        CALL RAZ:RET NZ;-------        LD A,(PPGM),(PPGP),A,(LOBU),A        LD HL,(LOBU+34):ADD A,L        RET C:CP PLEPG-PLGPG:RET NC        LD (PPG2),A        LD A,PLHPG:CALL MNGC;-------        CALL PDCHECK:RET C;-------        LD HL,LOBU,DE,(PHED)        LD A,D:CP #40:RET C        LD BC,512:LDIR:LD (PHED),DE        EX DE,HL:LD B,0:CALL NOPING        LD HL,LOBU+36WALK    LD A,(HL):INC HL:CALL MNGC_PL        LD A,(HL):INC HL:OR A:JR Z,LGW        PUSH HL        LD B,A,HL,#C000:CALL LOAD512        POP HL        JR WALKLGW     LD A,(PPG2),(PPGM),A        LD A,(PPFR):OR A:RET NZ        PUSH IX        LD IX,LGWND:CALL PRWOW        LD HL,LOBU+512,B,32:CALL NOPING        LD HL,LOBU+165+31        LD B,32,A,B:CALL NOMI        LD C,B:SUB B:SRL A:LD B,A        LD DE,LOBU+512,A,31:SUB B        LD E,A,B,0        LD A,C:OR A:JR Z,$+4:LDDR_LD HL,LOBU+512,DE,257,BC,32:CALL PRSRW        LD A,%01110001:CALL PRIAT_LD HL,TEM0,DE,#020D,BC,9:CALL PRSRW        CALL USPO        CALL NUSP        CALL RRESB        POP IX        LD A,(LOBU+197)        LD HL,LOBU+198        CP #14:CALL Z,EDTPR        CP #01:CALL Z,RAJT        RET;-------PDCHECK LD HL,#C000+165PDC     LD BC,(PHED)        OR A:SBC HL,BC:RET NC        ADD HL,BC        PUSH HL        LD DE,LOBU+165        LD B,32DCH     LD A,(DE):CP (HL):JR NZ,PDCH        INC HL,DE        DJNZ DCH        POP HL        SCF        RETPDCH    POP HL        LD BC,512:ADD HL,BC        JR PDC;-------PLGCL   LD A,PLHPG:CALL MNGC        LD HL,#C000,(PHED),HL        LD B,0:CALL NOPING        XOR A        LD (PPGP),A        LD (PPGM),A        RET;-------NOMI    CP (HL):RET NZ:DEC HL:DJNZ $-3        RET;---------------------------------------F11MENU PUSH IXMNU     LD HL,(PHED),A,H:CP #C2:JP C,F1E        LD A,PLHPG:CALL MNGC        LD HL,#C000+165,DE,LOBUZkL     LD BC,32:LDIR        LD BC,512-32:ADD HL,BC        LD A,(PHED+1):CP H:JR NZ,ZkL        EX DE,HL:LD BC,0-LOBU:ADD HL,BC.5      SRL H:RR L        LD A,L        LD HL,F11WND,DE,WINDC,BC,15:LDIR        LD IX,WINDC        PUSH AF        LD (IX+13),A        ADD A,2:LD (IX+5),A:CALL PRWOW_LD HL,TXTH,DE,#000B,BC,11:CALL PRSRW_LD A,%11110101:CALL PRIAT        POP BC        LD HL,LOBU,DE,#0101SPIG    PUSH BC        PUSH HL,DE        LD BC,32:CALL PRSRW;LD A,%01010000:CALL PRIAT        POP DE,HL        LD BC,32:ADD HL,BC:INC D        POP BC        DJNZ SPIG;-------F11MC   EI:HALT:CALL CURSOR        CALL UPPP,NZ,CrUP        CALL DWWW,NZ,CrDN        CALL LFFF,NZ,CrPU        CALL RGGG,NZ,CrPD        CALL DELE,NZ,PSDEL:JP NZ,MNU        CALL ESC:JR NZ,F1e        CALL ENKE:JR NZ,PSEXE        JR F11MC;-------F1e     CALL RRESBF1E     POP IX        RET;---------------------------------------PSEXE   LD A,PLHPG:CALL MNGC        LD A,(IX+12),(PSY),A:DEC A        LD H,0,L,A.9      ADD HL,HL        LD BC,#C000:ADD HL,BC        LD DE,LOBU,BC,512:LDIR        CALL RRESB        POP IX        LD A,(LOBU+197)        CP 2:JR NZ,$+3:INC A        CP 3:JR NZ,PSER        LD A,3:CALL AJT        CP 3:CALL Z,SEXY        RET;-------PSER    LD HL,TER3:JP ERR0;---------------------------------------PSDEL   LD HL,TXTK,DE,#010E,BC,14        CALL DLME:RET Z        LD A,PLHPG:CALL MNGC        LD HL,0,DE,1,BC,512-1        LD (HL),L        LDIR        LD A,(IX+12)        LD H,A,L,0        ADD HL,HL        LD BC,#C000:ADD HL,BC        LD DE,HL:DEC D,D        LD A,(DE)        PUSH DE        PUSH HL        LD HL,0:SBC HL,DE:LD BC,HL        POP HL:LDIR        LD HL,(PHED)        LD BC,0-512:ADD HL,BC        LD (PHED),HL        POP HL        CALL PSMOVE:LD A,C,(PPGM),A        CALL RRESB        LD A,1,(PSY),A        OR A        RETPSMOVE  ;i: A - Page (Logical);          HL - Headers to Patching        LD C,APSM     LD DE,(PHED)        OR A:SBC HL,DE:RET NC:ADD HL,DE        LD A,(HL),(HL),C        PUSH HL        LD DE,34:ADD HL,DE        LD B,(HL):CALL PSMDMA        POP HL        LD DE,512:ADD HL,DE        JR PSMPSMDMA  ;i: A - Source (Logical);           C - Dest (Logical);           B - Ln (Pages);        o: C - Dest (Logical)        ADD A,PLGPG:LD E,A        LD A,C:ADD A,PLGPG        LD D,A        CALL DMAPG:DJNZ $-3        RETDMAPG   PUSH BC        LD HL,0        LD BC,STS:INF:JP M,$-2        LD B,DMASL[:OUT L        LD B,DMASH[:OUT H        LD B,DMASX[:OUT E        LD B,DMADL[:OUT L        LD B,DMADH[:OUT H        LD B,DMADX[:OUT D        LD B,DMA_T[,A,31:OUT A        LD B,DMA_N[,A,255:OUT A        LD B,DMA_C[,A,%00000001:OUT A        LD B,STS[:INF:JP M,$-2        POP BC:INC C,D,E        RET;---------------------------------------